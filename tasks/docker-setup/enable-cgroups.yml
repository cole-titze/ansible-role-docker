---
- name: Ensure cgroups are configured correctly in cmdline.txt.
  ansible.builtin.replace:
    path: /boot/firmware/cmdline.txt
    regexp: '^([\w](?!.*\b{{ item }}\b).*)$'
    replace: '\1 {{ item }}'
  with_items:
    - "cgroup_memory=1"
    - "cgroup_enable=memory"
  notify: reboot-pi
  when: ansible_distribution == 'Debian'

- name: Ensure cgroups are configured correctly in ubuntuEnv.txt.
  ansible.builtin.replace:
    path: /boot/firmware/ubuntuEnv.txt
    regexp: '^(bootargs=[\w](?!.*\b{{ item }}\b).*)$'
    replace: '\1 {{ item }}'
  with_items:
    - "cgroup_memory=1"
    - "cgroup_enable=memory"
  notify: reboot-pi
  when: ansible_distribution == 'Ubuntu'